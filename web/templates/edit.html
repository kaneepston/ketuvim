<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>{{ page_title or ('ketuvim_nert for ' + image_name) }}</title>
</head>
<body>

    <main class="container">

        <h1>{{ page_title or ('ketuvim_nert for ' + image_name) }}</h1>

        {# Flash messages section #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="message-box {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="edit-container">
            <div class="image-column">
                <h2>Uploaded image</h2>
                <img src="{{ url_for('uploaded_file', filename=image_name) }}" alt="Uploaded image: {{ image_name }}">
            </div>

            <div class="text-column">

                <h2>Initial input</h2>
                <div class="message-box" style="white-space: pre-wrap; word-wrap: break-word; background-color: #e2e8f0;">{{ input_text or 'No input text provided.' }}</div>

                <hr style="margin: 20px 0;">

                <div id="save-form">
                    <input type="hidden" name="image_name" id="image_name" value="{{ image_name }}">
                    <input type="hidden" name="input_text" id="input_text_hidden" value="{{ input_text or '' }}">

                    <div>
                        <label for="corrected_text">ketuvim_nert output:</label>
                        {% if corrected_text %}
                            <div class="message-box">ketuvim_nert model output is shown below. You can edit it before saving/contributing.</div>
                        {% else %}
                             <div class="message-box">ketuvim_nert model did not produce output. You can enter text below and save/contribute.</div>
                        {% endif %}

                        <textarea id="corrected_text" name="corrected_text" rows="15">{{ corrected_text or '' }}</textarea>
                    </div>

                    <div id="status-message" style="margin-top: 10px; font-weight: bold;"></div>

                    <div class="button-group">
                         {# Add data-save-url attribute generated by Flask/Jinja #}
                        <button type="button" id="contribute-btn" data-save-url="{{ url_for('save_edited') }}">Contribute and save</button>
                        <button type="button" onclick="window.location.href='{{ url_for('history') }}'">View history</button>
                        <button type="button" onclick="window.location.href='{{ url_for('index') }}'">Go to main page</button>
                    </div>
                </div>
            </div>
        </div>

    </main>
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>

</body>
</html>
